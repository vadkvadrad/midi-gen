# MIDI Music Generator

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö MIDI —Ñ–∞–π–ª–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç LSTM –º–æ–¥–µ–ª—å –∏ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä REMI –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–∑–∏—Ü–∏–π.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Docker

```bash
# 1. –°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑
make build

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ
make download-data

# 3. –û–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª—å
make train

# 4. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –º—É–∑—ã–∫—É
make generate
```

–ì–æ—Ç–æ–≤–æ! –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º—É–∑—ã–∫–∞ –±—É–¥–µ—Ç –≤ –ø–∞–ø–∫–µ `output/`.

üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ Docker:** —Å–º. [DOCKER.md](DOCKER.md)

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üéµ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è MIDI –º—É–∑—ã–∫–∏ —Å –ø–æ–º–æ—â—å—é –æ–±—É—á–µ–Ω–Ω–æ–π LSTM –º–æ–¥–µ–ª–∏
- üéπ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–∞ REMI (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è MIDI)
- üìä –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TensorBoard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ–±—É—á–µ–Ω–∏—è
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å Kaggle
- üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π –∏ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repository-url>
cd midi-gen
```

2. –°–æ–±–µ—Ä–∏—Ç–µ Docker –æ–±—Ä–∞–∑:
```bash
make build
# –∏–ª–∏
docker-compose build
```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Kaggle API (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö):
   - –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ [Kaggle](https://www.kaggle.com/)
   - –°–∫–∞—á–∞–π—Ç–µ API —Ç–æ–∫–µ–Ω: Settings ‚Üí API ‚Üí Create New Token
   - –ü–æ–º–µ—Å—Ç–∏—Ç–µ `kaggle.json` –≤ `~/.kaggle/` (kagglehub –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥–µ—Ç –µ–≥–æ)
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞: `chmod 600 ~/.kaggle/kaggle.json`
   
   **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ `~/.kaggle` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ —Ö–æ—Å—Ç–∞

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repository-url>
cd midi-gen
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Kaggle API (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö):
   - –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ [Kaggle](https://www.kaggle.com/)
   - –°–∫–∞—á–∞–π—Ç–µ API —Ç–æ–∫–µ–Ω: Settings ‚Üí API ‚Üí Create New Token
   - –ü–æ–º–µ—Å—Ç–∏—Ç–µ `kaggle.json` –≤ `~/.kaggle/` (–∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å —á–µ—Ä–µ–∑ `make` –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `docker-compose`:

#### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
make download-data
# –∏–ª–∏
docker-compose run --rm midi-gen python download_data.py
```

#### 2. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

```bash
make train
# –∏–ª–∏
docker-compose run --rm midi-gen python train.py
```

#### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∏

```bash
make generate
# –∏–ª–∏
docker-compose run --rm midi-gen python generate.py
```

#### 4. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º

–î–ª—è —Ä–∞–±–æ—Ç—ã –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ:

```bash
make shell
# –∏–ª–∏
docker-compose exec midi-gen /bin/bash
```

#### 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

```bash
docker-compose run --rm midi-gen python generate.py \
    --model models/music_lstm.pth \
    --tokenizer models/tokenizer.json \
    --output output/my_music.mid \
    --gen-length 1000 \
    --temperature 0.8
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑ Docker

#### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ó–∞–≥—Ä—É–∑–∏—Ç–µ MIDI –¥–∞—Ç–∞—Å–µ—Ç —Å Kaggle:

```bash
python download_data.py
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∞—Ç–∞—Å–µ—Ç `soumikrakshit/classical-music-midi`. –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥–æ–π:

```bash
python download_data.py <dataset-name> <output-dir>
```

#### 2. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

–û–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª—å –Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```bash
python train.py
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ `config/config.yml` –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ `train.py`.

#### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∏

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—É—é –º—É–∑—ã–∫—É:

```bash
python generate.py
```

–° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```bash
python generate.py \
    --model models/music_lstm.pth \
    --tokenizer models/tokenizer.json \
    --output output/my_music.mid \
    --gen-length 1000 \
    --temperature 0.8
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
midi-gen/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.yml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ midi/               # MIDI —Ñ–∞–π–ª—ã (—Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏)
‚îú‚îÄ‚îÄ models/                 # –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ output/                 # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ MIDI —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prepare.py      # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ datasets/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ music_dataset.py
‚îÇ   ‚îú‚îÄ‚îÄ generation/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sampler.py      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lstm_improved.py # LSTM –º–æ–¥–µ–ª—å
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transformer.py   # Transformer –º–æ–¥–µ–ª—å (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
‚îÇ   ‚îî‚îÄ‚îÄ training/
‚îÇ       ‚îî‚îÄ‚îÄ trainer.py      # –õ–æ–≥–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ download_data.py        # –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ train.py                # –°–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ generate.py             # –°–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Dockerfile              # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Makefile                # –£–¥–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è Docker
‚îî‚îÄ‚îÄ .dockerignore           # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Docker
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ `config/config.yml`:

- **data**: –ø—É—Ç–∏ –∫ –¥–∞–Ω–Ω—ã–º –∏ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä—É
- **tokenizer**: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–∞ REMI
- **preprocessing**: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö (context_len, batch_size –∏ —Ç.–¥.)
- **model**: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏ (embed_size, hidden_size, num_layers)
- **training**: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è (epochs, learning_rate)
- **generation**: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (temperature, top_p)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ—Ç—Ä–∏–∫ –æ–±—É—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ TensorBoard:

**–° Docker:**
```bash
docker-compose run --rm -p 6006:6006 midi-gen tensorboard --logdir=runs --host=0.0.0.0
```

**–ë–µ–∑ Docker:**
```bash
tensorboard --logdir=runs
```

–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://localhost:6006`

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GPU –≤ Docker

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å NVIDIA GPU –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω [NVIDIA Container Toolkit](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html), —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ü–∏—é `deploy` –≤ `docker-compose.yml`:

```yaml
deploy:
  resources:
    reservations:
      devices:
        - driver: nvidia
          count: 1
          capabilities: [gpu]
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑:
```bash
docker-compose build
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ú–æ–¥–µ–ª—å
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: Multi-layer LSTM —Å embedding —Å–ª–æ–µ–º
- **–¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è**: REMI (Remi-like tokenization) - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è MIDI
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è**: –ê–≤—Ç–æ—Ä–µ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å nucleus sampling (top-p)

### –¢–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä REMI
REMI –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç MIDI —Å–æ–±—ã—Ç–∏—è –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤:
- –ù–æ—Ç—ã (Pitch, Velocity, Duration)
- –ü–æ–∑–∏—Ü–∏–∏ (Position, Bar)
- –ê–∫–∫–æ—Ä–¥—ã (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã)
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã

## –£–ª—É—á—à–µ–Ω–∏—è –∏ TODO

- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Transformer –º–æ–¥–µ–ª–∏
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ multi-instrument –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Music21 –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## –ê–≤—Ç–æ—Ä—ã

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ MIDI –º—É–∑—ã–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.

